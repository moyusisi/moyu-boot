<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.moyu.boot.plugin.codegen.mapper.DbTableMapper">

    <!-- 查询数据库表分页 -->
    <select id="getTablePage" resultType="com.moyu.boot.plugin.codegen.model.vo.TableVO">
        SELECT
        t1.TABLE_NAME ,
        t1.TABLE_COMMENT ,
        t1.TABLE_COLLATION,
        t1.ENGINE,
        t1.CREATE_TIME,
        CASE WHEN t2.id IS NOT NULL THEN 1 ELSE 0 END AS hasConfig
        FROM information_schema.tables t1 LEFT JOIN gen_config t2 on t1.TABLE_NAME = t2.table_name
        WHERE
        t1.TABLE_SCHEMA = (SELECT DATABASE())
        AND t1.table_type = 'BASE TABLE'
        <if test="param.searchKey != null and param.keywords.trim() neq ''">
            AND t1.TABLE_NAME LIKE CONCAT('%',#{param.searchKey},'%')
        </if>
        <!-- 排除的表 -->
        <if test="param.excludeTables != null and param.excludeTables.size() > 0">
            AND t1.TABLE_NAME NOT IN
            <foreach collection="param.excludeTables" item="excludeTable" open="(" close=")" separator=",">
                #{excludeTable}
            </foreach>
        </if>
        ORDER BY
        CREATE_TIME DESC
    </select>

</mapper>
